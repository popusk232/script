--[[
MADE BY 
(telegramm) @yabl9
(discord) bestik_
Полный код CrimLib, адаптированный для функционала ESP и AimBot.
Он включает все необходимые функции для создания UI (Toggle, Slider, Dropdown, Keybind, ColorPicker)
и логику переключения вкладок.
]]

local CrimLib = {}
local connections = {}
local tweenService = game:GetService("TweenService")
local userInputService = game:GetService("UserInputService")
local CoreGui = game:FindFirstChild('CoreGui')
local ScreenGui -- Будет определен в Initialize
local ScreenGui
local UnloadCallbacks = {}
local MainFrame 
local Title
local ContentFrame
local SidebarFrame
local CurrentTabName = "CombatLeft" -- Начальная вкладка

-- Хранилище для вкладок и колонок
CrimLib.Tabs = {}
CrimLib.yOffsets = {
    Settings = 40
}

-- [[ ВНУТРЕННИЕ ФУНКЦИИ ОТРИСОВКИ (ИЗ CRIM.LUA И CLICKGUI.LUA) ]]
-- [[ ВНУТРЕННИЕ ФУНКЦИИ ОТРИСОВКИ ]]

-- (Взято из ClickGui.lua для красивой анимации)
local function internalCreateToggle(parent, yPos, label, enabled, callback)
    local toggleState = enabled

local function internalCreateToggle(parent, yPos, label, enabled, callback)
    ClickButton.Text = ""
    ClickButton.ZIndex = 8

    ClickButton.MouseButton1Click:Connect(function()
    table.insert(connections, ClickButton.MouseButton1Click:Connect(function()
        toggleState = not toggleState

        tweenService:Create(ToggleButton, TweenInfo.new(0.15, Enum.EasingStyle.Quad), {
local function internalCreateToggle(parent, yPos, label, enabled, callback)
        }):Play()

        if callback then
            callback(toggleState) -- ВЫЗЫВАЕМ ВНЕШНЮЮ ЛОГИКУ
            callback(toggleState)
        end
    end)
    end))

    ClickButton.MouseEnter:Connect(function()
    table.insert(connections, ClickButton.MouseEnter:Connect(function()
        tweenService:Create(ToggleFrame, TweenInfo.new(0.1, Enum.EasingStyle.Quad), { BackgroundColor3 = Color3.fromRGB(32, 32, 32) }):Play()
    end)
    end))

    ClickButton.MouseLeave:Connect(function()
    table.insert(connections, ClickButton.MouseLeave:Connect(function()
        tweenService:Create(ToggleFrame, TweenInfo.new(0.1, Enum.EasingStyle.Quad), { BackgroundColor3 = Color3.fromRGB(28, 28, 28) }):Play()
    end)
    end))

    return ToggleFrame, toggleState
end

-- (Взято из Crim.lua)
local function internalCreateSlider(parent, yPos, label, defaultValue, minValue, maxValue, hasOverride, onValueChanged)
    local sliderValue = defaultValue
    local dragging = false
local function internalCreateSlider(parent, yPos, label, defaultValue, minValue,
    Label.TextSize = 13
    Label.TextXAlignment = Enum.TextXAlignment.Left

    if hasOverride then
        local OverrideLabel = Instance.new("TextLabel")
        OverrideLabel.Parent = SliderFrame
        OverrideLabel.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        OverrideLabel.BorderSizePixel = 0
        OverrideLabel.Position = UDim2.new(0, 165, 0.5, -8)
        OverrideLabel.Size = UDim2.new(0, 22, 0, 16)
        OverrideLabel.Font = Enum.Font.GothamBold
        OverrideLabel.Text = "HB"
        OverrideLabel.TextColor3 = Color3.fromRGB(130, 130, 130)
        OverrideLabel.TextSize = 8
        OverrideLabel:SetAttribute("HasBackground", true)

        local OverrideCorner = Instance.new("UICorner")
        OverrideCorner.CornerRadius = UDim.new(0, 2)
        OverrideCorner.Parent = OverrideLabel
    end

    local ValueLabel = Instance.new("TextLabel")
    ValueLabel.Parent = SliderFrame
    ValueLabel.BackgroundTransparency = 1
local function internalCreateSlider(parent, yPos, label, defaultValue, minValue,
    SliderFill.Size = UDim2.new(0, 0, 1, 0)
    SliderFill:SetAttribute("HasBackground", true)

    local FillCorner = Instance.new("UICorner")
    FillCorner.CornerRadius = UDim.new(0, 2)
    FillCorner.Parent = SliderFill

    local SliderThumb = Instance.new("Frame")
    SliderThumb.Parent = SliderFill
    SliderThumb.BackgroundColor3 = Color3.fromRGB(60, 160, 255)
local function internalCreateSlider(parent, yPos, label, defaultValue, minValue,
    SliderThumb.ZIndex = 2
    SliderThumb:SetAttribute("HasBackground", true)

    local ThumbCorner = Instance.new("UICorner")
    ThumbCorner.CornerRadius = UDim.new(0, 5)
    ThumbCorner.Parent = SliderThumb

    local function updateSlider(input)
        local mousePos = input.Position.X
        local trackAbsolutePos = SliderTrack.AbsolutePosition.X
        local trackSize = SliderTrack.AbsoluteSize.X
       
        local xOffset = math.clamp(mousePos - trackAbsolutePos, 0, trackSize)
        local percent = xOffset / trackSize

        local valueRange = maxValue - minValue
        local rawValue = minValue + (valueRange * percent)
        local newValue

        -- Округление в зависимости от типа (дробное или целое)
        if minValue < 1 or maxValue < 1 or tostring(minValue):find("%.") or tostring(maxValue):find("%.") then
             newValue = math.floor(rawValue * 100 + 0.5) / 100 -- до 2 знаков
        -- Округление до 2 знаков или до целого
        if maxValue <= 1 or tostring(minValue):find("%.") or tostring(maxValue):find("%.") then
             newValue = math.floor(rawValue * 100 + 0.5) / 100
        else
             newValue = math.floor(rawValue + 0.5) -- до целого
             newValue = math.floor(rawValue + 0.5)
        end

        sliderValue = newValue
        ValueLabel.Text = tostring(newValue)
        SliderFill.Size = UDim2.new(percent, 0, 1, 0)
        if onValueChanged then
            onValueChanged(newValue) -- ВЫЗЫВАЕМ ВНЕШНЮЮ ЛОГИКУ
            onValueChanged(newValue)
        end
    end

local function internalCreateSlider(parent, yPos, label, defaultValue, minValue,
        end
    end))

    table.insert(connections, SliderThumb.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end))
    
    local TrackButton = Instance.new("TextButton", SliderTrack)
    TrackButton.BackgroundTransparency = 1
    TrackButton.Size = UDim2.new(1, 0, 1, 0)
    TrackButton.Text = ""
    TrackButton.ZIndex = 1
    TrackButton.InputBegan:Connect(function(input)
    table.insert(connections, TrackButton.InputBegan:Connect(function(input)
         if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            updateSlider(input)
        end
    end)

    end))

    table.insert(connections, SliderFrame.MouseEnter:Connect(function()
        tweenService:Create(SliderFrame, TweenInfo.new(0.1, Enum.EasingStyle.Quad), {BackgroundColor3 = Color3.fromRGB(32, 32, 32)}):Play()
local function internalCreateSlider(parent, yPos, label, defaultValue, minValue,
    return SliderFrame, sliderValue
end

-- (Взято из Crim.lua)
local function internalCreateDropdown(parent, yPos, label, options, defaultOption, onSelected)
    local selected = defaultOption
    local DropdownFrame = Instance.new("Frame")
local function internalCreateDropdown(parent, yPos, label, options, defaultOptio
            selected = option
            SelectedLabel.Text = option
            if onSelected then
                onSelected(option) -- ВЫЗЫВАЕМ ВНЕШНЮЮ ЛОГИКУ
                onSelected(option)
            end
            tweenService:Create(OptionsFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, 0)}):Play()
            task.wait(0.2)
local function internalCreateDropdown(parent, yPos, label, options, defaultOptio
    end))

    table.insert(connections, DropdownFrame.MouseLeave:Connect(function()
        tweenService:Create(DropdownFrame, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(28, 28, 28)}):Play()
        tweenService:Create(DropdownFrame, TweenInfo.new(0.1, Enum.EasingStyle.Quad), {BackgroundColor3 = Color3.fromRGB(28, 28, 28)}):Play()
    end))

    return DropdownFrame, selected
end

-- (Взято из Crim.lua)
local function internalCreateKeybind(parent, yPos, label, defaultKey, onBind)
    local currentKey = defaultKey
    local KeybindFrame = Instance.new("Frame")
local function internalCreateKeybind(parent, yPos, label, defaultKey, onBind)
    KeybindFrame.Size = UDim2.new(1, -30, 0, 30)
    KeybindFrame:SetAttribute("HasBackground", true)

    local KeybindCorner = Instance.new("UICorner")
    KeybindCorner.CornerRadius = UDim.new(0, 4)
    KeybindCorner.Parent = KeybindFrame

    local Label = Instance.new("TextLabel")
    Label.Parent = KeybindFrame
    Label.BackgroundTransparency = 1
local function internalCreateKeybind(parent, yPos, label, defaultKey, onBind)
    KeyButton.BackgroundTransparency = 1
    KeyButton.Size = UDim2.new(1, 0, 1, 0)
    KeyButton.Text = ""
    local binding = false 

    local binding = false
    table.insert(connections, KeyButton.MouseButton1Click:Connect(function()
        binding = true
        KeyLabel.Text = "..."
local function internalCreateKeybind(parent, yPos, label, defaultKey, onBind)
            currentKey = input.KeyCode
            KeyLabel.Text = currentKey.Name
            if onBind then
                onBind(currentKey) -- ВЫЗЫВАЕМ ВНЕШНЮЮ ЛОГИКУ
                onBind(currentKey)
            end
        end
    end))

    table.insert(connections, KeybindFrame.MouseEnter:Connect(function()
    table.insert(connections, KeybindFrame.MouseEnter:Connect(function() 
        tweenService:Create(KeybindFrame, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(32, 32, 32)}):Play()
    end))

    
    table.insert(connections, KeybindFrame.MouseLeave:Connect(function()
        tweenService:Create(KeybindFrame, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(28, 28, 28)}):Play()
        tweenService:Create(KeybindFrame, TweenInfo.new(0.1, Enum.EasingStyle.Quad), {BackgroundColor3 = Color3.fromRGB(28, 28, 28)}):Play()
    end))

    return KeybindFrame
    return KeybindFrame, currentKey
end

-- (Взято из Crim.lua)
local function internalCreateColorPicker(parent, yPos, label, defaultColor, onColorChanged)
    local currentColor = defaultColor
    local expanded = false
local function internalCreateColorPicker(parent, yPos, label, defaultColor, onCo
    ColorPickerFrame.Size = UDim2.new(1, -30, 0, 30)
    ColorPickerFrame:SetAttribute("HasBackground", true)

    local ColorPickerCorner = Instance.new("UICorner")
    ColorPickerCorner.CornerRadius = UDim.new(0, 4)
    ColorPickerCorner.Parent = ColorPickerFrame
    local ColorButton = Instance.new("TextButton")
    ColorButton.Parent = ColorPickerFrame
    ColorButton.BackgroundTransparency = 1
    ColorButton.Size = UDim2.new(1, 0, 1, 0)
    ColorButton.Text = ""

    local Label = Instance.new("TextLabel")
    Label.Parent = ColorPickerFrame
local function internalCreateColorPicker(parent, yPos, label, defaultColor, onCo
    Label.TextSize = 13
    Label.TextXAlignment = Enum.TextXAlignment.Left

    local ColorPreview = Instance.new("Frame")
    ColorPreview.Parent = ColorPickerFrame
    ColorPreview.BackgroundColor3 = currentColor
    ColorPreview.BorderSizePixel = 0
    ColorPreview.Position = UDim2.new(1, -40, 0.5, -10)
    ColorPreview.Size = UDim2.new(0, 20, 0, 20)
    ColorPreview:SetAttribute("HasBackground", true)

    local PreviewCorner = Instance.new("UICorner")
    PreviewCorner.CornerRadius = UDim.new(0, 4)
    PreviewCorner.Parent = ColorPreview

    local ColorButton = Instance.new("TextButton")
    ColorButton.Parent = ColorPickerFrame
    ColorButton.BackgroundTransparency = 1
    ColorButton.Size = UDim2.new(1, 0, 1, 0)
    ColorButton.Text = ""
    local ColorDisplay = Instance.new("Frame")
    ColorDisplay.Parent = ColorPickerFrame
    ColorDisplay.BackgroundColor3 = defaultColor
    ColorDisplay.BorderSizePixel = 0
    ColorDisplay.Position = UDim2.new(1, -38, 0.5, -10)
    ColorDisplay.Size = UDim2.new(0, 20, 0, 20)
    ColorDisplay:SetAttribute("HasBackground", true)

    local PickerFrame = Instance.new("Frame")
    PickerFrame.Parent = ColorPickerFrame
local function internalCreateColorPicker(parent, yPos, label, defaultColor, onCo
    PickerFrame.ClipsDescendants = true
    PickerFrame:SetAttribute("HasBackground", true)

    local PickerCorner = Instance.new("UICorner")
    PickerCorner.CornerRadius = UDim.new(0, 4)
    PickerCorner.Parent = PickerFrame

    local function updateColor()
        ColorPreview.BackgroundColor3 = currentColor
        ColorDisplay.BackgroundColor3 = currentColor
        if onColorChanged then
            onColorChanged(currentColor) -- ВЫЗЫВАЕМ ВНЕШНЮЮ ЛОГИКУ
            onColorChanged(currentColor)
        end
    end

    local rSlider = internalCreateSlider(PickerFrame, 0, "R", currentColor.R * 255, 0, 255, false, function(value)
    
    local rSlider, rValue
    rSlider, rValue = internalCreateSlider(PickerFrame, 0, "R", currentColor.R * 255, 0, 255, false, function(value)
        currentColor = Color3.fromRGB(value, currentColor.G * 255, currentColor.B * 255)
        updateColor()
    end)

    local gSlider = internalCreateSlider(PickerFrame, 40, "G", currentColor.G * 255, 0, 255, false, function(value)
    local gSlider, gValue
    gSlider, gValue = internalCreateSlider(PickerFrame, 40, "G", currentColor.G * 255, 0, 255, false, function(value)
        currentColor = Color3.fromRGB(currentColor.R * 255, value, currentColor.B * 255)
        updateColor()
    end)

    local bSlider = internalCreateSlider(PickerFrame, 80, "B", currentColor.B * 255, 0, 255, false, function(value)
    local bSlider, bValue
    bSlider, bValue = internalCreateSlider(PickerFrame, 80, "B", currentColor.B * 255, 0, 255, false, function(value)
        currentColor = Color3.fromRGB(currentColor.R * 255, currentColor.G * 255, value)
        updateColor()
    end)
local function internalCreateColorPicker(parent, yPos, label, defaultColor, onCo
        end
    end))

    table.insert(connections, ColorPickerFrame.MouseEnter:Connect(function()
    table.insert(connections, ColorPickerFrame.MouseEnter:Connect(function() 
        tweenService:Create(ColorPickerFrame, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(32, 32, 32)}):Play()
    end))

    table.insert(connections, ColorPickerFrame.MouseLeave:Connect(function()
        tweenService:Create(ColorPickerFrame, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(28, 28, 28)}):Play()
    end))

    return ColorPickerFrame
end

-- (Взято из Crim.lua)
local function internalSetTransparency(transparency)
    local function recurse(obj)
        if (obj:IsA("Frame") or obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("ImageLabel") or obj:IsA("ImageButton")) and obj:GetAttribute("HasBackground") then
            obj.BackgroundTransparency = transparency
local function switchTab(tabName)
    if CurrentTabName == tabName then return end
    
    local tabFrame = CrimLib.Tabs[tabName]
    if tabFrame then
        -- Скрыть все вкладки
        for _, tab in pairs(CrimLib.Tabs) do
            tab.Visible = false
        end
        for _, child in ipairs(obj:GetChildren()) do
            recurse(child)
        
        -- Показать выбранную вкладку
        tabFrame.Visible = true
        CurrentTabName = tabName
        
        -- Обновить заголовок
        local titleText = ""
        if tabName:find("Combat") then
            titleText = "Combat"
        elseif tabName:find("Enemy") then
            titleText = "Enemy"
        elseif tabName:find("Settings") then
            titleText = "Settings"
        end
    end
    -- Убедимся, что ScreenGui существует
    if ScreenGui then
        recurse(ScreenGui)
        Title.Text = "CrimBot | " .. titleText
    end
end

-- [[ ПУБЛИЧНЫЙ API ]]

-- [[ 6. ИНИЦИАЛИЗАЦИЯ И API БИБЛИОТЕКИ ]]

-- :Initialize() создает весь каркас GUI
function CrimLib:Initialize(TitleName, MenuKey, UnloadKey)
    -- (Весь код создания GUI из Crim.lua)
-- :Initialize
function CrimLib:Initialize(titleName, UnloadKey, MenuKey)
    ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "RagebotUI"
    ScreenGui.Parent = CoreGui
    ScreenGui.Name = "CrimLibUI"
    ScreenGui.Parent = CoreGui or game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.ResetOnSpawn = false

    local MainFrame = Instance.new("Frame")
    MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = ScreenGui
    MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    MainFrame.BorderSizePixel = 0
    MainFrame.Position = UDim2.new(0.5, -421.5, 0.5, -287.5)
    MainFrame.Size = UDim2.new(0, 843, 0, 575)
    MainFrame.Position = UDim2.new(0.5, -300, 0.5, -287.5)
    MainFrame.Size = UDim2.new(0, 600, 0, 575)
    MainFrame.Visible = false
    MainFrame.Active = true
    MainFrame:SetAttribute("HasBackground", true)

    
    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 8)
    MainCorner.Parent = MainFrame

    local Header = Instance.new("Frame")
    Header.Name = "Header"
    Header.Parent = MainFrame
    Header.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
    Header.BorderSizePixel = 0
    Header.Size = UDim2.new(1, 0, 0, 60)
    Header:SetAttribute("HasBackground", true)

    local HeaderCorner = Instance.new("UICorner")
    HeaderCorner.CornerRadius = UDim.new(0, 8)
    HeaderCorner.Parent = Header

    local LogoIcon = Instance.new("ImageLabel")
    LogoIcon.Parent = Header
    LogoIcon.BackgroundTransparency = 1
    LogoIcon.Position = UDim2.new(0, 20, 0, 12)
    LogoIcon.Size = UDim2.new(0, 36, 0, 36)
    LogoIcon.Image = "rbxassetid://97446581390925"
    LogoIcon.ImageColor3 = Color3.fromRGB(255, 255, 255)
    LogoIcon.ScaleType = Enum.ScaleType.Fit

    local Title = Instance.new("TextLabel")
    Title.Parent = Header
    
    Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.Parent = MainFrame
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0, 70, 0, 18)
    Title.Size = UDim2.new(0, 200, 0, 24)
    Title.Position = UDim2.new(0, 80, 0, 0)
    Title.Size = UDim2.new(1, -80, 0, 60)
    Title.Font = Enum.Font.GothamBold
    Title.Text = TitleName or "CrimLib"
    Title.Text = (titleName or "CrimLib") .. " | Combat"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 20
    Title.TextXAlignment = Enum.TextXAlignment.Left

    local Sidebar = Instance.new("Frame")
    Sidebar.Name = "Sidebar"
    Sidebar.Parent = MainFrame
    Sidebar.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
    Sidebar.BorderSizePixel = 0
    Sidebar.Position = UDim2.new(0, 0, 0, 60)
    Sidebar.Size = UDim2.new(0, 70, 0, 515)
    Sidebar:SetAttribute("HasBackground", true)

    local currentTab = 2
    local tabs = {}
    local sidebarIcons = {
        {icon = "rbxassetid://98370306170658", y = 15, name = "Legitbot", size = {16.9, 16.9}},
        {icon = "rbxassetid://107512202152283", y = 85, active = true, name = "Combat", size = {19, 19}}, 
        {icon = "rbxassetid://127827492424396", y = 155, name = "Enemy", size = {28, 26}},
        {icon = "rbxassetid://100545076798978", y = 225, name = "World", size = {32, 32}},
        {icon = "rbxassetid://107710676270056", y = 295, name = "SkinChanger", size = {48, 46}},
        {icon = "rbxassetid://103915348216097", y = 365, name = "Misc", size = {37, 35}},
        {icon = "rbxassetid://97047003599965", y = 435, name = "Settings", size = {20, 20}} 
    }

    local ContentFrame = Instance.new("Frame")
    SidebarFrame = Instance.new("Frame")
    SidebarFrame.Name = "Sidebar"
    SidebarFrame.Parent = MainFrame
    SidebarFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    SidebarFrame.BorderSizePixel = 0
    SidebarFrame.Size = UDim2.new(0, 70, 1, 0)
    
    ContentFrame = Instance.new("Frame")
    ContentFrame.Name = "ContentFrame"
    ContentFrame.Parent = MainFrame
    ContentFrame.BackgroundTransparency = 1
    ContentFrame.Position = UDim2.new(0, 70, 0, 60)
    ContentFrame.Size = UDim2.new(1, -70, 1, -60)
    ContentFrame.ClipsDescendants = true

    local TabContainer = Instance.new("Frame")
    TabContainer.Name = "TabContainer"
    TabContainer.Parent = ContentFrame
    TabContainer.BackgroundTransparency = 1
    TabContainer.Size = UDim2.new(1, 0, 1, 0)
    TabContainer.Visible = true

    local EnemyContainer = Instance.new("Frame")
    EnemyContainer.Name = "EnemyContainer"
    EnemyContainer.Parent = ContentFrame
    EnemyContainer.BackgroundTransparency = 1
    EnemyContainer.Size = UDim2.new(1, 0, 1, 0)
    EnemyContainer.Visible = false

    local SettingsContainer = Instance.new("Frame")
    SettingsContainer.Name = "SettingsContainer"
    SettingsContainer.Parent = ContentFrame
    SettingsContainer.BackgroundTransparency = 1
    SettingsContainer.Size = UDim2.new(1, 0, 1, 0)
    SettingsContainer.Visible = false

    -- Логика переключения вкладок
    for index, iconData in ipairs(sidebarIcons) do
        local IconFrame = Instance.new("Frame")
        IconFrame.Parent = Sidebar
        IconFrame.Name = "Tab_" .. index
        IconFrame.BackgroundColor3 = iconData.active and Color3.fromRGB(25, 25, 25) or Color3.fromRGB(18, 18, 18)
        IconFrame.BorderSizePixel = 0
        IconFrame.Position = UDim2.new(0, 0, 0, iconData.y)
        IconFrame.Size = UDim2.new(1, 0, 0, 60)
        IconFrame:SetAttribute("HasBackground", true)

        local ActiveIndicator = Instance.new("Frame")
        ActiveIndicator.Parent = IconFrame
        ActiveIndicator.Name = "Indicator"
        ActiveIndicator.BackgroundColor3 = Color3.fromRGB(60, 160, 255)
        ActiveIndicator.BorderSizePixel = 0
        ActiveIndicator.Position = UDim2.new(0, 0, 0, 0)
        ActiveIndicator.Size = UDim2.new(0, iconData.active and 4 or 0, 1, 0)
        ActiveIndicator:SetAttribute("HasBackground", true)

        if iconData.isText then
            -- (код для текстовой иконки)
        else
            local Icon = Instance.new("ImageLabel")
            Icon.Parent = IconFrame
            Icon.BackgroundTransparency = 1
            Icon.Position = UDim2.new(0.5, -iconData.size[1] / 2, 0.5, -iconData.size[2] / 2)
            Icon.Size = UDim2.new(0, iconData.size[1], 0, iconData.size[2])
            Icon.Image = iconData.icon
            Icon.ImageColor3 = Color3.fromRGB(200, 200, 200)
            Icon.ScaleType = Enum.ScaleType.Fit
        end

        local TabButton = Instance.new("TextButton")
        TabButton.Parent = IconFrame
        TabButton.BackgroundTransparency = 1
        TabButton.Size = UDim2.new(1, 0, 1, 0)
        TabButton.Text = ""
        TabButton.ZIndex = 3

        table.insert(connections, TabButton.MouseButton1Click:Connect(function()
            for i, tab in ipairs(tabs) do
                local frame = Sidebar:FindFirstChild("Tab_" .. i)
                if frame then
                    local indicator = frame:FindFirstChild("Indicator")
                    tweenService:Create(frame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(18, 18, 18)}):Play()
                    tweenService:Create(indicator, TweenInfo.new(0.2), {Size = UDim2.new(0, 0, 1, 0)}):Play()
                end
                if tab.content then
                    tab.content.Visible = false
                end
            end
            currentTab = index
            tweenService:Create(IconFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(25, 25, 25)}):Play()
            tweenService:Create(ActiveIndicator, TweenInfo.new(0.2), {Size = UDim2.new(0, 4, 1, 0)}):Play()
            Title.Text = (TitleName or "CrimLib") .. " | " .. iconData.name
            if tabs[index] and tabs[index].content then
                tabs[index].content.Visible = true
            end
        end))
        
        table.insert(connections, TabButton.MouseEnter:Connect(function()
            if currentTab ~= index then
                tweenService:Create(IconFrame, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(22, 22, 22)}):Play()
            end
        end))
        table.insert(connections, TabButton.MouseLeave:Connect(function()
            if currentTab ~= index then
                tweenService:Create(IconFrame, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(18, 18, 18)}):Play()
            end
        end))

        tabs[index] = {name = iconData.name, frame = IconFrame, content = nil}
    end
    
    -- Создаем колонки и сохраняем ссылки на них
    local LeftColumn = Instance.new("Frame")
    LeftColumn.Name = "LeftColumn"
    LeftColumn.Parent = TabContainer
    LeftColumn.BackgroundTransparency = 1
    LeftColumn.Position = UDim2.new(0, 0, 0, 0)
    LeftColumn.Size = UDim2.new(0.5, 0, 1, 0)

    local RightColumn = Instance.new("Frame")
    RightColumn.Name = "RightColumn"
    RightColumn.Parent = TabContainer
    RightColumn.BackgroundTransparency = 1
    RightColumn.Position = UDim2.new(0.5, 0, 0, 0)
    RightColumn.Size = UDim2.new(0.5, 0, 1, 0)

    local EnemyLeftColumn = Instance.new("Frame")
    EnemyLeftColumn.Name = "LeftColumn"
    EnemyLeftColumn.Parent = EnemyContainer
    EnemyLeftColumn.BackgroundTransparency = 1
    EnemyLeftColumn.Position = UDim2.new(0, 0, 0, 0)
    EnemyLeftColumn.Size = UDim2.new(0.5, 0, 1, 0)

    local EnemyRightColumn = Instance.new("Frame")
    EnemyRightColumn.Name = "RightColumn"
    EnemyRightColumn.Parent = EnemyContainer
    EnemyRightColumn.BackgroundTransparency = 1
    EnemyRightColumn.Position = UDim2.new(0.5, 0, 0, 0)
    EnemyRightColumn.Size = UDim2.new(0.5, 0, 1, 0)

    -- Сохраняем ссылки для API
    CrimLib.Tabs["CombatLeft"] = LeftColumn
    CrimLib.Tabs["CombatRight"] = RightColumn
    CrimLib.Tabs["EnemyLeft"] = EnemyLeftColumn
    CrimLib.Tabs["EnemyRight"] = EnemyRightColumn
    CrimLib.Tabs["Settings"] = SettingsContainer
    local Scroll = Instance.new("ScrollingFrame")
    Scroll.Parent = ContentFrame
    Scroll.BackgroundTransparency = 1
    Scroll.Size = UDim2.new(1, 0, 1, 0)
    Scroll.CanvasSize = UDim2.new(0, 0, 0, 600)
    Scroll.ScrollBarThickness = 6
    ContentFrame = Scroll -- Сделать Scrollable

    -- Логика перетаскивания (Header)
    local HeaderFrame = Instance.new("Frame")
    HeaderFrame.Parent = MainFrame
    HeaderFrame.BackgroundTransparency = 1
    HeaderFrame.Size = UDim2.new(1, 0, 0, 60)
    HeaderFrame.Active = true
    HeaderFrame.ZIndex = 10

    -- Привязка контента к табам из Crim.lua
    tabs[2].content = TabContainer
    tabs[3].content = EnemyContainer
    tabs[7].content = SettingsContainer
    
    -- Логика перетаскивания (Drag and Drop)
    local dragging = false
    local dragInput
    local dragStart
    local startPos

    local function update(input)
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    local dragStart = Vector2.new()
    local startPos = UDim2.new()
    
    local function dragStartFunc(input)
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        input.InputChanged:Connect(update)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
        end
    end

    
    local function dragEndFunc(input)
        dragging = false
    end

    Header.InputBegan:Connect(dragStartFunc)
    Header.InputEnded:Connect(dragEndFunc)
    local function dragUpdate(input)
         local delta = input.Position - dragStart
         MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    table.insert(connections, HeaderFrame.InputBegan:Connect(dragStartFunc))
    table.insert(connections, userInputService.InputEnded:Connect(dragEndFunc))
    table.insert(connections, userInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            dragUpdate(input)
        end
    end))
    

    -- Логика биндов INSERT и DELETE
    local menuVisible = false
function CrimLib:Initialize(TitleName, MenuKey, UnloadKey)
function CrimLib:Initialize(TitleName, MenuKey, UnloadKey)
            menuVisible = not menuVisible
            MainFrame.Visible = menuVisible
        elseif input.KeyCode == unloadKey then
            -- Вызываем функцию очистки, если она есть
            if CrimLib.Unload then
                CrimLib.Unload()
            end
            
            for _, connection in ipairs(connections) do
                connection:Disconnect()
            end
            -- Вызов функции очистки
            for _, callback in ipairs(UnloadCallbacks) do callback() end
            for _, connection in ipairs(connections) do connection:Disconnect() end
            connections = {}
            if ScreenGui then
                ScreenGui:Destroy()
            end
            if ScreenGui then ScreenGui:Destroy() end
        end
    end))
end

-- Публичная функция для установки прозрачности
function CrimLib:SetTransparency(value)
    internalSetTransparency(value)
-- Вспомогательная функция для создания кнопки вкладки
local function createTabButton(tabName, buttonText, yOffset)
    local Button = Instance.new("TextButton")
    Button.Parent = SidebarFrame
    Button.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Button.Size = UDim2.new(1, 0, 0, 40)
    Button.Position = UDim2.new(0, 0, 0, yOffset)
    Button.Text = buttonText
    Button.Font = Enum.Font.Gotham
    Button.TextColor3 = Color3.fromRGB(150, 150, 150)
    Button.TextSize = 14
    Button.TextWrapped = true

    table.insert(connections, Button.MouseButton1Click:Connect(function()
        switchTab(tabName)
    end))
end

-- Публичная функция для очистки (вызывается из Loader.lua)
function CrimLib:AddUnloadCallback(callback)
    CrimLib.Unload = callback
end
-- :CreateTab
function CrimLib:CreateTab(name, column)
    local buttonYOffset = (#CrimLib.Tabs) * 40
    local contentColParent = Instance.new("Frame")
    contentColParent.Name = "Tab_" .. name
    contentColParent.Parent = ContentFrame
    contentColParent.BackgroundTransparency = 1
    contentColParent.Size = UDim2.new(0.5, 0, 1, 0)
    contentColParent.Position = (column == "Right" and UDim2.new(0.5, 0, 0, 0)) or UDim2.new(0, 0, 0, 0)
    contentColParent.Visible = name == "CombatLeft" -- Показываем CombatLeft по умолчанию

    -- Создание кнопки на боковой панели
    local buttonText = ""
    if name == "CombatLeft" or name == "CombatRight" then
        buttonText = "Combat"
    elseif name == "EnemyLeft" or name == "EnemyRight" then
        buttonText = "Enemy"
    end
    
    if not CrimLib.Tabs[name] and name:sub(-4) == "Left" then
        createTabButton(name, buttonText, buttonYOffset)
    end

-- [[ 7. ПУБЛИЧНЫЕ API ФУНКЦИИ (ПЕРЕМЕННЫЕ) ]]
    CrimLib.Tabs[name] = contentColParent
    return contentColParent
end

-- :AddToggle
function CrimLib:AddToggle(tabName, settings)
    local parent = CrimLib.Tabs[tabName]
    if not parent then warn("CrimLib: Invalid tabName for AddToggle: " .. tabName) return end
    

    local yPos = CrimLib.yOffsets[tabName]
    internalCreateToggle(parent, yPos, settings.Name, settings.DefaultValue, settings.Callback)
    local frame, value = internalCreateToggle(parent, yPos, settings.Name, settings.DefaultValue, settings.Callback)
    CrimLib.yOffsets[tabName] = yPos + 40
    return frame, value
end

-- :AddSlider
function CrimLib:AddSlider(tabName, settings)
    if not parent then warn("CrimLib: Invalid tabName for AddSlider: " .. tabName) return end

    local yPos = CrimLib.yOffsets[tabName]
    internalCreateSlider(parent, yPos, settings.Name, settings.DefaultValue, settings.Min, settings.Max, settings.Override or false, settings.Callback)
    local frame, value = internalCreateSlider(parent, yPos, settings.Name, settings.DefaultValue, settings.Min, settings.Max, settings.Override or false, settings.Callback)
    CrimLib.yOffsets[tabName] = yPos + 40
    return frame, value
end

-- :AddDropdown
function CrimLib:AddDropdown(tabName, settings)
    if not parent then warn("CrimLib: Invalid tabName for AddDropdown: " .. tabName) return end

    local yPos = CrimLib.yOffsets[tabName]
    internalCreateDropdown(parent, yPos, settings.Name, settings.Options, settings.DefaultValue, settings.Callback)
    local frame, value = internalCreateDropdown(parent, yPos, settings.Name, settings.Options, settings.DefaultValue, settings.Callback)
    CrimLib.yOffsets[tabName] = yPos + 40
    return frame, value
end

-- :AddKeybind
function CrimLib:AddKeybind(tabName, settings)
    if not parent then warn("CrimLib: Invalid tabName for AddKeybind: " .. tabName) return end

    local yPos = CrimLib.yOffsets[tabName]
    internalCreateKeybind(parent, yPos, settings.Name, settings.DefaultValue, settings.Callback)
    local frame, value = internalCreateKeybind(parent, yPos, settings.Name, settings.DefaultValue, settings.Callback)
    CrimLib.yOffsets[tabName] = yPos + 40
    return frame, value
end

-- :AddColorPicker
function CrimLib:AddColorPicker(tabName, settings)
    if not parent then warn("CrimLib: Invalid tabName for AddColorPicker: " .. tabName) return end

    local yPos = CrimLib.yOffsets[tabName]
    internalCreateColorPicker(parent, yPos, settings.Name, settings.DefaultValue, settings.Callback)
    CrimLib.yOffsets[tabName] = yPos + 40
    local frame = internalCreateColorPicker(parent, yPos, settings.Name, settings.DefaultValue, settings.Callback)
    CrimLib.yOffsets[tabName] = yPos + 120 -- Увеличиваем отступ
    return frame
end

-- :AddUnloadCallback
function CrimLib:AddUnloadCallback(callback)
    table.insert(UnloadCallbacks, callback)
end

return CrimLib
