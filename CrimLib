-- Rayfield UI Library | Стиль как в ClickGui.lua (Neverlose-style)
-- Автор: переработал под твой стиль

local Rayfield = {}
Rayfield.Flags = {}

local Services = {
    UserInputService = game:GetService("UserInputService"),
    TweenService = game:GetService("TweenService"),
    RunService = game:GetService("RunService"),
    CoreGui = game:GetService("CoreGui")
}

local TweenInfoFast = TweenInfo.new(0.15, Enum.EasingStyle.Quad)

-- Основное окно
function Rayfield:CreateWindow(Settings)
    local Window = {}
    Window.Tabs = {}

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "Rayfield"
    ScreenGui.Parent = Services.CoreGui
    ScreenGui.ResetOnSpawn = false

    local Main = Instance.new("Frame")
    Main.Name = "Main"
    Main.Size = UDim2.new(0, 700, 0, 540)
    Main.Position = UDim2.new(0.5, -350, 0.5, -270)
    Main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    Main.BorderSizePixel = 0
    Main.Active = true
    Main.Parent = ScreenGui

    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 8)
    Corner.Parent = Main

    -- Header
    local Header = Instance.new("Frame")
    Header.Name = "Header"
    Header.Size = UDim2.new(1, 0, 0, 50)
    Header.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
    Header.Parent = Main

    local HeaderCorner = Instance.new("UICorner")
    HeaderCorner.CornerRadius = UDim.new(0, 8)
    HeaderCorner.Parent = Header

    local Title = Instance.new("TextLabel")
    Title.Text = Settings.Name or "Rayfield Menu"
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 16
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0, 20, 0, 0)
    Title.Size = UDim2.new(1, -40, 1, 0)
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = Header

    -- Dragging
    local dragging, dragStart, startPos
    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position
        end
    end)
    Header.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    Services.UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    -- Content
    local Content = Instance.new("Frame")
    Content.Name = "Content"
    Content.Size = UDim2.new(1, 0, 1, -50)
    Content.Position = UDim2.new(0, 0, 0, 50)
    Content.BackgroundTransparency = 1
    Content.Parent = Main

    function Window:CreateTab(TabInfo)
        local Tab = {}
        Tab.Elements = {}

        local TabButton = Instance.new("TextButton")
        TabButton.Size = UDim2.new(0, 140, 0, 36)
        TabButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
        TabButton.Text = TabInfo.Name
        TabButton.Font = Enum.Font.Gotham
        TabButton.TextSize = 13
        TabButton.TextColor3 = Color3.fromRGB(180, 180, 180)
        TabButton.Parent = Header
        TabButton.Position = UDim2.new(0, 20 + (#Window.Tabs * 150), 0, 0)

        local TabContent = Instance.new("ScrollingFrame")
        TabContent.Size = UDim2.new(1, -40, 1, -20)
        TabContent.Position = UDim2.new(0, 20, 0, 10)
        TabContent.BackgroundTransparency = 1
        TabContent.CanvasSize = UDim2.new(0, 0, 0, 0)
        TabContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
        TabContent.ScrollBarThickness = 4
        TabContent.Visible = #Window.Tabs == 0
        TabContent.Parent = Content

        local Layout = Instance.new("UIListLayout")
        Layout.Padding = UDim.new(0, 8)
        Layout.Parent = TabContent

        TabButton.MouseButton1Click:Connect(function()
            for _, t in pairs(Window.Tabs) do
                t.Content.Visible = false
                t.Button.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
                t.Button.TextColor3 = Color3.fromRGB(180, 180, 180)
            end
            TabContent.Visible = true
            TabButton.BackgroundColor3 = Color3.fromRGB(60, 160, 255)
            TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        end)

        if #Window.Tabs == 0 then
            TabButton.BackgroundColor3 = Color3.fromRGB(60, 160, 255)
            TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        end

        -- Элементы
        function Tab:CreateSection(Name)
            local Section = Instance.new("Frame")
            Section.Size = UDim2.new(1, 0, 0, 30)
            Section.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
            Section.Parent = TabContent

            local Corner = Instance.new("UICorner")
            Corner.CornerRadius = UDim.new(0, 6)
            Corner.Parent = Section

            local Title = Instance.new("TextLabel")
            Title.Text = Name
            Title.Font = Enum.Font.GothamBold
            Title.TextSize = 12
            Title.TextColor3 = Color3.fromRGB(180, 180, 180)
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.new(0, 15, 0, 0)
            Title.Size = UDim2.new(1, -30, 1, 0)
            Title.TextXAlignment = Enum.TextXAlignment.Left
            Title.Parent = Section

            local Container = Instance.new("Frame")
            Container.Size = UDim2.new(1, 0, 0, 0)
            Container.Position = UDim2.new(0, 0, 1, 0)
            Container.BackgroundTransparency = 1
            Container.Parent = Section
            Container.AutomaticSize = Enum.AutomaticSize.Y

            local List = Instance.new("UIListLayout")
            List.Padding = UDim.new(0, 6)
            List.Parent = Container

            return Container
        end

        function Tab:CreateToggle(Config)
            local Value = Config.CurrentValue or false
            Rayfield.Flags[Config.Flag] = {Value = Value}

            local Toggle = Instance.new("Frame")
            Toggle.Size = UDim2.new(1, 0, 0, 32)
            Toggle.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
            Toggle.Parent = Config.Parent or TabContent

            local Corner = Instance.new("UICorner", Toggle)
            Corner.CornerRadius = UDim.new(0, 4)

            local Label = Instance.new("TextLabel")
            Label.Text = Config.Name
            Label.Font = Enum.Font.Gotham
            Label.TextSize = 13
            Label.TextColor3 = Color3.fromRGB(200, 200, 200)
            Label.BackgroundTransparency = 1
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.Size = UDim2.new(1, -60, 1, 0)
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Toggle

            local SwitchBg = Instance.new("Frame")
            SwitchBg.Size = UDim2.new(0, 36, 0, 20)
            SwitchBg.Position = UDim2.new(1, -44, 0.5, -10)
            SwitchBg.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
            SwitchBg.Parent = Toggle

            local SwitchCorner = Instance.new("UICorner", SwitchBg)
            SwitchCorner.CornerRadius = UDim.new(1, 0)

            local Circle = Instance.new("Frame")
            Circle.Size = UDim2.new(0, 16, 0, 16)
            Circle.Position = Value and UDim2.new(0, 18, 0, 2) or UDim2.new(0, 2, 0, 2)
            Circle.BackgroundColor3 = Value and Color3.fromRGB(60, 160, 255) or Color3.fromRGB(70, 70, 70)
            Circle.Parent = SwitchBg

            local CircleCorner = Instance.new("UICorner", Circle)
            CircleCorner.CornerRadius = UDim.new(1, 0)

            Toggle.MouseButton1Click:Connect(function()
                Value = not Value
                Rayfield.Flags[Config.Flag].Value = Value
                Services.TweenService:Create(Circle, TweenInfoFast, {
                    Position = Value and UDim2.new(0, 18, 0, 2) or UDim2.new(0, 2, 0, 2),
                    BackgroundColor3 = Value and Color3.fromRGB(60, 160, 255) or Color3.fromRGB(70, 70, 70)
                }):Play()
                Services.TweenService:Create(Label, TweenInfoFast, {TextColor3 = Value and Color3.fromRGB(255, 200, 50) or Color3.fromRGB(200, 200, 200)}):Play()
                Config.Callback(Value)
            end)

            Toggle.MouseEnter:Connect(function() Services.TweenService:Create(Toggle, TweenInfoFast, {BackgroundColor3 = Color3.fromRGB(32, 32, 32)}):Play() end)
            Toggle.MouseLeave:Connect(function() Services.TweenService:Create(Toggle, TweenInfoFast, {BackgroundColor3 = Color3.fromRGB(28, 28, 28)}):Play() end)
        end

        function Tab:CreateSlider(Config)
            local Value = Config.CurrentValue or Config.Min
            Rayfield.Flags[Config.Flag] = {Value = Value}

            local Slider = Instance.new("Frame")
            Slider.Size = UDim2.new(1, 0, 0, 36)
            Slider.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
            Slider.Parent = Config.Parent or TabContent

            local Corner = Instance.new("UICorner", Slider)
            Corner.CornerRadius = UDim.new(0, 4)

            local Label = Instance.new("TextLabel")
            Label.Text = Config.Name .. ": " .. Value .. (Config.Suffix or "")
            Label.Font = Enum.Font.Gotham
            Label.TextSize = 13
            Label.TextColor3 = Color3.fromRGB(200, 200, 200)
            Label.BackgroundTransparency = 1
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.Size = UDim2.new(1, -100, 0.5, 0)
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Slider

            local Track = Instance.new("Frame")
            Track.Size = UDim2.new(1, -24, 0, 6)
            Track.Position = UDim2.new(0, 12, 0.6, 0)
            Track.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
            Track.Parent = Slider

            local TrackCorner = Instance.new("UICorner", Track)
            TrackCorner.CornerRadius = UDim.new(1, 0)

            local Fill = Instance.new("Frame")
            Fill.Size = UDim2.new((Value - Config.Min) / (Config.Max - Config.Min), 0, 1, 0)
            Fill.BackgroundColor3 = Color3.fromRGB(60, 160, 255)
            Fill.Parent = Track

            local FillCorner = Instance.new("UICorner", Fill)
            FillCorner.CornerRadius = UDim.new(1, 0)

            local Thumb = Instance.new("Frame")
            Thumb.Size = UDim2.new(0, 16, 0, 16)
            Thumb.Position = UDim2.new((Value - Config.Min) / (Config.Max - Config.Min), -8, 0.5, -8)
            Thumb.BackgroundColor3 = Color3.fromRGB(60, 160, 255)
            Thumb.Parent = Track

            local ThumbCorner = Instance.new("UICorner", Thumb)
            ThumbCorner.CornerRadius = UDim.new(1, 0)

            local dragging = false
            Track.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end end)
            Services.UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
            Services.UserInputService.InputChanged:Connect(function(i)
                if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
                    local percent = math.clamp((i.Position.X - Track.AbsolutePosition.X) / Track.AbsoluteSize.X, 0, 1)
                    Value = Config.Min + (Config.Max - Config.Min) * percent
                    if Config.Increment then Value = math.floor(Value / Config.Increment) * Config.Increment end
                    Rayfield.Flags[Config.Flag].Value = Value
                    Fill.Size = UDim2.new(percent, 0, 1, 0)
                    Thumb.Position = UDim2.new(percent, -8, 0.5, -8)
                    Label.Text = Config.Name .. ": " .. Value .. (Config.Suffix or "")
                    Config.Callback(Value)
                end
            end)

            Slider.MouseEnter:Connect(function() Services.TweenService:Create(Slider, TweenInfoFast, {BackgroundColor3 = Color3.fromRGB(32, 32, 32)}):Play() end)
            Slider.MouseLeave:Connect(function() Services.TweenService:Create(Slider, TweenInfoFast, {BackgroundColor3 = Color3.fromRGB(28, 28, 28)}):Play() end)
        end

        function Tab:CreateDropdown(Config)
            local Value = Config.CurrentValue or Config.Options[1]
            Rayfield.Flags[Config.Flag] = {Value = Value}

            local Dropdown = Instance.new("Frame")
            Dropdown.Size = UDim2.new(1, 0, 0, 32)
            Dropdown.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
            Dropdown.Parent = Config.Parent or TabContent

            local Corner = Instance.new("UICorner", Dropdown)
            Corner.CornerRadius = UDim.new(0, 4)

            local Label = Instance.new("TextLabel")
            Label.Text = Config.Name
            Label.Font = Enum.Font.Gotham
            Label.TextSize = 13
            Label.TextColor3 = Color3.fromRGB(200, 200, 200)
            Label.BackgroundTransparency = 1
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.Size = UDim2.new(0, 140, 1, 0)
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Dropdown

            local Button = Instance.new("TextButton")
            Button.Size = UDim2.new(0, 160, 0, 26)
            Button.Position = UDim2.new(1, -174, 0.5, -13)
            Button.BackgroundColor3 = Color3.fromRGB(32, 32, 32)
            Button.Text = "  " .. Value
            Button.TextColor3 = Color3.fromRGB(180, 180, 180)
            Button.Font = Enum.Font.Gotham
            Button.TextSize = 12
            Button.TextXAlignment = Enum.TextXAlignment.Left
            Button.Parent = Dropdown

            local BtnCorner = Instance.new("UICorner", Button)
            BtnCorner.CornerRadius = UDim.new(0, 4)

            local Arrow = Instance.new("TextLabel")
            Arrow.Text = "Down Arrow"
            Arrow.Rotation = 0
            Arrow.Position = UDim2.new(1, -20, 0, 0)
            Arrow.Size = UDim2.new(0, 20, 1, 0)
            Arrow.BackgroundTransparency = 1
            Arrow.TextColor3 = Color3.fromRGB(150, 150, 150)
            Arrow.Font = Enum.Font.Gotham
            Arrow.TextSize = 10
            Arrow.Parent = Button

            local List = Instance.new("ScrollingFrame")
            List.Size = UDim2.new(0, 160, 0, 100)
            List.Position = UDim2.new(1, -174, 1, 2)
            List.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
            List.Visible = false
            List.ScrollBarThickness = 4
            List.Parent = Dropdown

            local ListCorner = Instance.new("UICorner", List)
            ListCorner.CornerRadius = UDim.new(0, 4)

            local ListLayout = Instance.new("UIListLayout", List)
            ListLayout.Padding = UDim.new(0, 2)

            for _, opt in ipairs(Config.Options) do
                local Opt = Instance.new("TextButton")
                Opt.Size = UDim2.new(1, -4, 0, 26)
                Opt.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
                Opt.Text = "  " .. opt
                Opt.TextColor3 = Color3.fromRGB(180, 180, 180)
                Opt.Font = Enum.Font.Gotham
                Opt.TextSize = 12
                Opt.TextXAlignment = Enum.TextXAlignment.Left
                Opt.Parent = List

                Opt.MouseButton1Click:Connect(function()
                    Value = opt
                    Rayfield.Flags[Config.Flag].Value = Value
                    Button.Text = "  " .. Value
                    List.Visible = false
                    Arrow.Rotation = 0
                    Config.Callback(Value)
                end)
            end

            Button.MouseButton1Click:Connect(function()
                List.Visible = not List.Visible
                Arrow.Rotation = List.Visible and 180 or 0
            end)
        end

        table.insert(Window.Tabs, {Button = TabButton, Content = TabContent})
        return Tab
    end

    -- Toggle: Insert
    Services.UserInputService.InputBegan:Connect(function(i)
        if i.KeyCode == Enum.KeyCode.Insert then
            Main.Visible = not Main.Visible
        end
    end)

    return Window
end

getgenv().Rayfield = Rayfield
