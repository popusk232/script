local Library = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local function makeDraggable(frame, dragObj)
	local dragging, dragInput, dragStart, startPos
	dragObj.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)
	dragObj.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if dragging and input == dragInput then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

function Library:CreateWindow(config)
	local Name = config.Name or "Sapphire"
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "SapphireUI"
	ScreenGui.Parent = CoreGui
	ScreenGui.ResetOnSpawn = false

	local MainFrame = Instance.new("Frame")
	MainFrame.Size = UDim2.new(0,843,0,575)
	MainFrame.Position = UDim2.new(0.5,-421.5,0.5,-287.5)
	MainFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
	MainFrame.BorderSizePixel = 0
	MainFrame.Visible = false
	MainFrame.ClipsDescendants = true
	MainFrame.Parent = ScreenGui
	Instance.new("UICorner",MainFrame).CornerRadius = UDim.new(0,8)

	local Header = Instance.new("Frame")
	Header.Size = UDim2.new(1,0,0,60)
	Header.BackgroundColor3 = Color3.fromRGB(18,18,18)
	Header.BorderSizePixel = 0
	Header.Parent = MainFrame
	Instance.new("UICorner",Header).CornerRadius = UDim.new(0,8)

	local Logo = Instance.new("ImageLabel")
	Logo.Position = UDim2.new(0,20,0,12)
	Logo.Size = UDim2.new(0,36,0,36)
	Logo.BackgroundTransparency = 1
	Logo.Image = "rbxassetid://97446581390925"
	Logo.ScaleType = Enum.ScaleType.Fit
	Logo.Parent = Header

	local Title = Instance.new("TextLabel")
	Title.Position = UDim2.new(0,70,0,18)
	Title.Size = UDim2.new(0,400,0,24)
	Title.BackgroundTransparency = 1
	Title.Font = Enum.Font.GothamBold
	Title.Text = Name
	Title.TextColor3 = Color3.fromRGB(255,255,255)
	Title.TextSize = 20
	Title.TextXAlignment = Enum.TextXAlignment.Left
	Title.Parent = Header

	local Sidebar = Instance.new("Frame")
	Sidebar.Size = UDim2.new(0,70,1,-60)
	Sidebar.Position = UDim2.new(0,0,0,60)
	Sidebar.BackgroundColor3 = Color3.fromRGB(18,18,18)
	Sidebar.BorderSizePixel = 0
	Sidebar.Parent = MainFrame

	local Content = Instance.new("Frame")
	Content.Size = UDim2.new(1,-70,1,-60)
	Content.Position = UDim2.new(0,70,0,60)
	Content.BackgroundTransparency = 1
	Content.ClipsDescendants = true
	Content.Parent = MainFrame

	makeDraggable(MainFrame,Header)

	local Window = {}
	local CurrentTab = nil

	local tabs = {
		{name="Legitbot",icon=98370306170658,y=15,size={16.9,16.9}},
		{name="Ragebot",icon=107512202152283,y=85,size={19,19},active=true},
		{name="Enemy",icon=127827492424396,y=155,size={28,26}},
		{name="World",icon=100545076798978,y=225,size={32,32}},
		{name="SkinChanger",icon=107710676270056,y=295,size={48,46}},
		{name="Misc",icon=103915348216097,y=365,size={37,35}},
		{name="Config",icon=97047003599965,y=435,size={20,20}}
	}

	for _,data in ipairs(tabs) do
		local TabButton = Instance.new("Frame")
		TabButton.Size = UDim2.new(1,0,0,60)
		TabButton.Position = UDim2.new(0,0,0,data.y)
		TabButton.BackgroundColor3 = data.active and Color3.fromRGB(25,25,25) or Color3.fromRGB(18,18,18)
		TabButton.BorderSizePixel = 0
		TabButton.Parent = Sidebar

		local Indicator = Instance.new("Frame")
		Indicator.Size = data.active and UDim2.new(0,4,1,0) or UDim2.new(0,0,1,0)
		Indicator.BackgroundColor3 = Color3.fromRGB(60,160,255)
		Indicator.BorderSizePixel = 0
		Indicator.Parent = TabButton

		local Icon = Instance.new("ImageLabel")
		Icon.BackgroundTransparency = 1
		Icon.Size = UDim2.new(0,data.size[1],0,data.size[2])
		Icon.Position = UDim2.new(0.5,-data.size[1]/2,0.5,-data.size[2]/2)
		Icon.Image = "rbxassetid://"..data.icon
		Icon.ImageColor3 = Color3.fromRGB(200,200,200)
		Icon.ScaleType = Enum.ScaleType.Fit
		Icon.Parent = TabButton

		local ClickArea = Instance.new("TextButton")
		ClickArea.Size = UDim2.new(1,0,1,0)
		ClickArea.BackgroundTransparency = 1
		ClickArea.Text = ""
		ClickArea.Parent = TabButton

		local TabContent = Instance.new("Frame")
		TabContent.Size = UDim2.new(1,0,1,0)
		TabContent.BackgroundTransparency = 1
		TabContent.Visible = data.active or false
		TabContent.Parent = Content

		local Layout = Instance.new("UIListLayout")
		Layout.Parent = TabContent
		Layout.SortOrder = Enum.SortOrder.LayoutOrder
		Layout.Padding = UDim.new(0,10)
		Layout.HorizontalAlignment = Enum.HorizontalAlignment.Left
		Layout.FillDirection = Enum.FillDirection.Horizontal

		ClickArea.MouseButton1Click:Connect(function()
			if CurrentTab then
				TweenService:Create(CurrentTab.TabButton,TweenInfo.new(0.2),{BackgroundColor3=Color3.fromRGB(18,18,18)}):Play()
				TweenService:Create(CurrentTab.Indicator,TweenInfo.new(0.2),{Size=UDim2.new(0,0,1,0)}):Play()
				CurrentTab.TabContent.Visible = false
			end
			TweenService:Create(TabButton,TweenInfo.new(0.2),{BackgroundColor3=Color3.fromRGB(25,25,25)}):Play()
			TweenService:Create(Indicator,TweenInfo.new(0.2),{Size=UDim2.new(0,4,1,0)}):Play()
			TabContent.Visible = true
			Title.Text = data.name
			CurrentTab = {TabButton=TabButton,Indicator=Indicator,TabContent=TabContent}
		end)

		if data.active then
			CurrentTab = {TabButton=TabButton,Indicator=Indicator,TabContent=TabContent}
			Title.Text = data.name
		end

		local Tab = {}

		function Tab:Section(name)
			local Frame = Instance.new("Frame")
			Frame.Size = UDim2.new(0.5,-15,1,-30)
			Frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
			Frame.BorderSizePixel = 0
			Frame.Parent = TabContent
			Instance.new("UICorner",Frame).CornerRadius = UDim.new(0,6)

			local TitleLabel = Instance.new("TextLabel")
			TitleLabel.Position = UDim2.new(0,15,0,10)
			TitleLabel.Size = UDim2.new(1,-30,0,25)
			TitleLabel.BackgroundTransparency = 1
			TitleLabel.Font = Enum.Font.GothamBold
			TitleLabel.Text = name:upper()
			TitleLabel.TextColor3 = Color3.fromRGB(180,180,180)
			TitleLabel.TextSize = 12
			TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
			TitleLabel.Parent = Frame

			local Scroll = Instance.new("ScrollingFrame")
			Scroll.Size = UDim2.new(1,0,1,-45)
			Scroll.Position = UDim2.new(0,0,0,45)
			Scroll.BackgroundTransparency = 1
			Scroll.BorderSizePixel = 0
			Scroll.ScrollBarThickness = 4
			Scroll.CanvasSize = UDim2.new(0,0,0,0)
			Scroll.Parent = Frame

			local List = Instance.new("UIListLayout")
			List.Parent = Scroll
			List.SortOrder = Enum.SortOrder.LayoutOrder
			List.Padding = UDim.new(0,5)

			local Elements = {}

			function Elements:Toggle(options)
				local enabled = options.Enabled or false
				local callback = options.Callback or function()end

				local Frame = Instance.new("Frame")
				Frame.Size = UDim2.new(1,-30,0,30)
				Frame.BackgroundColor3 = Color3.fromRGB(28,28,28)
				Frame.BorderSizePixel = 0
				Frame.Parent = Scroll
				Instance.new("UICorner",Frame).CornerRadius = UDim.new(0,4)

				local Label = Instance.new("TextLabel")
				Label.Size = UDim2.new(1,-50,1,0)
				Label.Position = UDim2.new(0,12,0,0)
				Label.BackgroundTransparency = 1
				Label.Font = Enum.Font.Gotham
				Label.Text = options.Name or "Toggle"
				Label.TextColor3 = Color3.fromRGB(200,200,200)
				Label.TextSize = 13
				Label.TextXAlignment = Enum.TextXAlignment.Left
				Label.Parent = Frame

				local Button = Instance.new("TextButton")
				Button.Size = UDim2.new(0,20,0,20)
				Button.Position = UDim2.new(1,-25,0.5,-10)
				Button.BackgroundColor3 = enabled and Color3.fromRGB(60,160,255) or Color3.fromRGB(35,35,35)
				Button.Text = ""
				Button.Parent = Frame
				Instance.new("UICorner",Button).CornerRadius = UDim.new(1,0)

				Button.MouseButton1Click:Connect(function()
					enabled = not enabled
					TweenService:Create(Button,TweenInfo.new(0.2),{BackgroundColor3 = enabled and Color3.fromRGB(60,160,255) or Color3.fromRGB(35,35,35)}):Play()
					callback(enabled)
				end)

				return Frame
			end

			function Elements:Slider(options)
				local value = options.Default or options.Min or 0
				local min = options.Min or 0
				local max = options.Max or 100
				local step = options.Step or 1
				local callback = options.Callback or function()end

				local Frame = Instance.new("Frame")
				Frame.Size = UDim2.new(1,-30,0,45)
				Frame.BackgroundColor3 = Color3.fromRGB(28,28,28)
				Frame.BorderSizePixel = 0
				Frame.Parent = Scroll
				Instance.new("UICorner",Frame).CornerRadius = UDim.new(0,4)

				local Label = Instance.new("TextLabel")
				Label.Size = UDim2.new(1,-70,0,20)
				Label.Position = UDim2.new(0,12,0,4)
				Label.BackgroundTransparency = 1
				Label.Font = Enum.Font.GothamBold
				Label.Text = options.Name or "Slider"
				Label.TextColor3 = Color3.fromRGB(200,200,200)
				Label.TextSize = 13
				Label.TextXAlignment = Enum.TextXAlignment.Left
				Label.Parent = Frame

				local ValueLabel = Instance.new("TextLabel")
				ValueLabel.Size = UDim2.new(0,60,0,20)
				ValueLabel.Position = UDim2.new(1,-70,0,4)
				ValueLabel.BackgroundTransparency = 1
				ValueLabel.Font = Enum.Font.GothamBold
				ValueLabel.Text = tostring(value)
				ValueLabel.TextColor3 = Color3.fromRGB(255,200,50)
				ValueLabel.TextSize = 13
				ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
				ValueLabel.Parent = Frame

				local Track = Instance.new("Frame")
				Track.Size = UDim2.new(1,-24,0,6)
				Track.Position = UDim2.new(0,12,0,28)
				Track.BackgroundColor3 = Color3.fromRGB(20,20,20)
				Track.BorderSizePixel = 0
				Track.Parent = Frame
				Instance.new("UICorner",Track).CornerRadius = UDim.new(1,0)

				local Fill = Instance.new("Frame")
				Fill.Size = UDim2.new((value-min)/(max-min),0,1,0)
				Fill.BackgroundColor3 = Color3.fromRGB(60,160,255)
				Fill.BorderSizePixel = 0
				Fill.Parent = Track
				Instance.new("UICorner",Fill).CornerRadius = UDim.new(1,0)

				local Knob = Instance.new("Frame")
				Knob.Size = UDim2.new(0,16,0,16)
				Knob.Position = UDim2.new((value-min)/(max-min),-8,0.5,-8)
				Knob.BackgroundColor3 = Color3.fromRGB(255,200,50)
				Knob.BorderSizePixel = 0
				Knob.Parent = Track
				Instance.new("UICorner",Knob).CornerRadius = UDim.new(1,0)

				local dragging = false

				local function update(v)
					local ratio = (v-min)/(max-min)
					TweenService:Create(Fill,TweenInfo.new(0.1),{Size=UDim2.new(ratio,0,1,0)}):Play()
					TweenService:Create(Knob,TweenInfo.new(0.1),{Position=UDim2.new(ratio,-8,0.5,-8)}):Play()
					ValueLabel.Text = tostring(v)
					callback(v)
				end

				Track.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 then
						dragging = true
						local rel = math.clamp((input.Position.X - Track.AbsolutePosition.X)/Track.AbsoluteSize.X,0,1)
						value = math.floor(min + rel*(max-min)/step + 0.5)*step
						update(value)
					end
				end)

				UserInputService.InputChanged:Connect(function(input)
					if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
						local rel = math.clamp((input.Position.X - Track.AbsolutePosition.X)/Track.AbsoluteSize.X,0,1)
						value = math.floor(min + rel*(max-min)/step + 0.5)*step
						update(value)
					end
				end)

				UserInputService.InputEnded:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
				end)

				return {SetValue=function(v) value=v update(v)end}
			end

			return Elements
		end

		Window[data.name] = Tab
	end

	UserInputService.InputBegan:Connect(function(input,gp)
		if not gp and input.KeyCode == Enum.KeyCode.Insert then
			MainFrame.Visible = not MainFrame.Visible
		end
	end)

	return Window
end

return Library
