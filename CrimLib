-- Rayfield UI Library | Neverlose / ClickGui Style (2025)
-- Полностью исправленная версия — без ошибок MouseButton1Click
-- loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))() — пример использования

local Rayfield = {}
Rayfield.Flags = {}

local Services = {
    UIS = game:GetService("UserInputService"),
    TS = game:GetService("TweenService"),
    CGui = game:GetService("CoreGui")
}

local TweenFast = TweenInfo.new(0.15, Enum.EasingStyle.Quad)

function Rayfield:CreateWindow(Options)
    Options = Options or {}
    local Window = {}
    Window.Tabs = {}

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "RayfieldUI_" .. math.random(1000,9999)
    ScreenGui.Parent = Services.CGui
    ScreenGui.ResetOnSpawn = false

    local Main = Instance.new("Frame")
    Main.Size = UDim2.new(0, 720, 0, 560)
    Main.Position = UDim2.fromScale(0.5, 0.5)
    Main.AnchorPoint = Vector2.new(0.5, 0.5)
    Main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    Main.BorderSizePixel = 0
    Main.Active = true
    Main.Parent = ScreenGui

    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 8)
    MainCorner.Parent = Main

    -- Header
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 50)
    Header.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
    Header.Parent = Main

    local HeaderCorner = Instance.new("UICorner")
    HeaderCorner.CornerRadius = UDim.new(0, 8)
    HeaderCorner.Parent = Header

    local Title = Instance.new("TextLabel")
    Title.Text = Options.Name or "Rayfield Menu"
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 17
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0, 20, 0, 0)
    Title.Size = UDim2.new(1, -40, 1, 0)
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = Header

    -- Dragging
    local dragging = false
    local dragStart, startPos
    Header.InputBegan:Connect(function(inp)
        if inp.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = inp.Position
            startPos = Main.Position
        end
    end)
    Header.InputChanged:Connect(function(inp)
        if dragging and inp.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = inp.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    Services.UIS.InputEnded:Connect(function(inp)
        if inp.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
    end)

    -- Tabs Bar
    local TabBar = Instance.new("Frame")
    TabBar.Size = UDim2.new(1, -40, 0, 36)
    TabBar.Position = UDim2.new(0, 20, 0, 60)
    TabBar.BackgroundTransparency = 1
    TabBar.Parent = Main

    local TabLayout = Instance.new("UIListLayout")
    TabLayout.FillDirection = Enum.FillDirection.Horizontal
    TabLayout.Padding = UDim.new(0, 8)
    TabLayout.Parent = TabBar

    -- Content
    local Content = Instance.new("ScrollingFrame")
    Content.Size = UDim2.new(1, -40, 1, -110)
    Content.Position = UDim2.new(0, 20, 0, 100)
    Content.BackgroundTransparency = 1
    Content.ScrollBarThickness = 4
    Content.AutomaticCanvasSize = Enum.AutomaticSize.Y
    Content.Parent = Main

    function Window:CreateTab(TabOptions)
        local Tab = {}
        Tab.Elements = {}

        local TabButton = Instance.new("TextButton")
        TabButton.Size = UDim2.new(0, 140, 1, 0)
        TabButton.BackgroundColor3 = #Window.Tabs == 0 and Color3.fromRGB(60, 160, 255) or Color3.fromRGB(28, 28, 28)
        TabButton.TextColor3 = #Window.Tabs == 0 and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(180, 180, 180)
        TabButton.Text = TabOptions.Name
        TabButton.Font = Enum.Font.Gotham
        TabButton.TextSize = 13
        TabButton.AutoButtonColor = false
        TabButton.Parent = TabBar

        local TabContent = Instance.new("Frame")
        TabContent.Size = UDim2.new(1, 0, 1, 0)
        TabContent.BackgroundTransparency = 1
        TabContent.Visible = #Window.Tabs == 0
        TabContent.Parent = Content

        local ContentLayout = Instance.new("UIListLayout")
        ContentLayout.Padding = UDim.new(0, 8)
        ContentLayout.Parent = TabContent

        TabButton.MouseButton1Click:Connect(function()
            for _, t in pairs(Window.Tabs) do
                t.Content.Visible = false
                t.Button.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
                t.Button.TextColor3 = Color3.fromRGB(180, 180, 180)
            end
            TabContent.Visible = true
            TabButton.BackgroundColor3 = Color3.fromRGB(60, 160, 255)
            TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        end)

        -- Section
        function Tab:CreateSection(Name)
            local Section = Instance.new("Frame")
            Section.Size = UDim2.new(1, 0, 0, 32)
            Section.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
            Section.Parent = TabContent

            local Corner = Instance.new("UICorner", Section)
            Corner.CornerRadius = UDim.new(0, 6)

            local Title = Instance.new("TextLabel")
            Title.Text = Name
            Title.Font = Enum.Font.GothamBold
            Title.TextSize = 12
            Title.TextColor3 = Color3.fromRGB(180, 180, 180)
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.new(0, 15, 0, 0)
            Title.Size = UDim2.new(1, -30, 1, 0)
            Title.TextXAlignment = Enum.TextXAlignment.Left
            Title.Parent = Section

            local Container = Instance.new("Frame")
            Container.Position = UDim2.new(0, 0, 1, 0)
            Container.Size = UDim2.new(1, 0, 0, 0)
            Container.BackgroundTransparency = 1
            Container.AutomaticSize = Enum.AutomaticSize.Y
            Container.Parent = Section

            local List = Instance.new("UIListLayout")
            List.Padding = UDim.new(0, 6)
            List.Parent = Container

            return Container
        end

        -- Toggle (ИСПРАВЛЕНО — без ошибок!)
        function Tab:CreateToggle(Config)
            local Value = Config.CurrentValue or false
            Rayfield.Flags[Config.Flag] = {Value = Value}

            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, 0, 0, 32)
            Frame.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
            Frame.Parent = Config.Parent or TabContent

            local Corner = Instance.new("UICorner", Frame)
            Corner.CornerRadius = UDim.new(0, 4)

            local Label = Instance.new("TextLabel")
            Label.Text = Config.Name
            Label.Font = Enum.Font.Gotham
            Label.TextSize = 13
            Label.TextColor3 = Value and Color3.fromRGB(255, 200, 50) or Color3.fromRGB(200, 200, 200)
            Label.BackgroundTransparency = 1
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.Size = UDim2.new(1, -60, 1, 0)
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Frame

            local Switch = Instance.new("Frame")
            Switch.Size = UDim2.new(0, 36, 0, 20)
            Switch.Position = UDim2.new(1, -44, 0.5, -10)
            Switch.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
            Switch.Parent = Frame

            local SC = Instance.new("UICorner", Switch)
            SC.CornerRadius = UDim.new(1, 0)

            local Circle = Instance.new("Frame")
            Circle.Size = UDim2.new(0, 16, 0, 16)
            Circle.Position = Value and UDim2.new(0, 18, 0, 2) or UDim2.new(0, 2, 0, 2)
            Circle.BackgroundColor3 = Value and Color3.fromRGB(60, 160, 255) or Color3.fromRGB(70, 70, 70)
            Circle.Parent = Switch

            local CC = Instance.new("UICorner", Circle)
            CC.CornerRadius = UDim.new(1, 0)

            -- Кликабельная область (ОБЯЗАТЕЛЬНО TextButton!)
            local ClickArea = Instance.new("TextButton")
            ClickArea.Size = UDim2.new(1, 0, 1, 0)
            ClickArea.BackgroundTransparency = 1
            ClickArea.Text = ""
            ClickArea.ZIndex = 10
            ClickArea.Parent = Frame

            ClickArea.MouseButton1Click:Connect(function()
                Value = not Value
                Rayfield.Flags[Config.Flag].Value = Value

                Services.TS:Create(Circle, TweenFast, {
                    Position = Value and UDim2.new(0, 18, 0, 2) or UDim2.new(0, 2, 0, 2),
                    BackgroundColor3 = Value and Color3.fromRGB(60, 160, 255) or Color3.fromRGB(70, 70, 70)
                }):Play()

                Services.TS:Create(Label, TweenFast, {
                    TextColor3 = Value and Color3.fromRGB(255, 200, 50) or Color3.fromRGB(200, 200, 200)
                }):Play()

                if Config.Callback then Config.Callback(Value) end
            end)

            ClickArea.MouseEnter:Connect(function()
                Services.TS:Create(Frame, TweenFast, {BackgroundColor3 = Color3.fromRGB(32, 32, 32)}):Play()
            end)
            ClickArea.MouseLeave:Connect(function()
                Services.TS:Create(Frame, TweenFast, {BackgroundColor3 = Color3.fromRGB(28, 28, 28)}):Play()
            end)
        end

        -- Slider (тоже исправлен)
        function Tab:CreateSlider(Config)
            local Value = Config.CurrentValue or Config.Min
            Rayfield.Flags[Config.Flag] = {Value = Value}

            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, 0, 0, 42)
            Frame.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
            Frame.Parent = Config.Parent or TabContent

            local Corner = Instance.new("UICorner", Frame)
            Corner.CornerRadius = UDim.new(0, 4)

            local Label = Instance.new("TextLabel")
            Label.Text = Config.Name .. ": " .. Value .. (Config.Suffix or "")
            Label.Font = Enum.Font.Gotham
            Label.TextSize = 13
            Label.TextColor3 = Color3.fromRGB(200, 200, 200)
            Label.BackgroundTransparency = 1
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.Size = UDim2.new(1, -100, 0.5, 0)
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Frame

            local Track = Instance.new("Frame")
            Track.Size = UDim2.new(1, -24, 0, 6)
            Track.Position = UDim2.new(0, 12, 0.6, 0)
            Track.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
            Track.Parent = Frame

            local TC = Instance.new("UICorner", Track)
            TC.CornerRadius = UDim.new(1, 0)

            local Fill = Instance.new("Frame")
            Fill.Size = UDim2.new((Value - Config.Min)/(Config.Max - Config.Min), 0, 1, 0)
            Fill.BackgroundColor3 = Color3.fromRGB(60, 160, 255)
            Fill.Parent = Track

            local FC = Instance.new("UICorner", Fill)
            FC.CornerRadius = UDim.new(1, 0)

            local Thumb = Instance.new("Frame")
            Thumb.Size = UDim2.new(0, 16, 0, 16)
            Thumb.Position = UDim2.new((Value - Config.Min)/(Config.Max - Config.Min), -8, 0.5, -8)
            Thumb.BackgroundColor3 = Color3.fromRGB(60, 160, 255)
            Thumb.Parent = Track

            local THC = Instance.new("UICorner", Thumb)
            THC.CornerRadius = UDim.new(1, 0)

            local ClickArea = Instance.new("TextButton")
            ClickArea.Size = UDim2.new(1, 0, 1, 0)
            ClickArea.BackgroundTransparency = 1
            ClickArea.Text = ""
            ClickArea.ZIndex = 5
            ClickArea.Parent = Frame

            local dragging = false
            ClickArea.InputBegan:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = true
                end
            end)
            Services.UIS.InputEnded:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
            end)
            Services.UIS.InputChanged:Connect(function(i)
                if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
                    local ratio = math.clamp((i.Position.X - Track.AbsolutePosition.X) / Track.AbsoluteSize.X, 0, 1)
                    Value = Config.Min + (Config.Max - Config.Min) * ratio
                    if Config.Increment then
                        Value = math.floor(Value / Config.Increment + 0.5) * Config.Increment
                    end
                    Rayfield.Flags[Config.Flag].Value = Value
                    Fill.Size = UDim2.new(ratio, 0, 1, 0)
                    Thumb.Position = UDim2.new(ratio, -8, 0.5, -8)
                    Label.Text = Config.Name .. ": " .. Value .. (Config.Suffix or "")
                    if Config.Callback then Config.Callback(Value) end
                end
            end)

            ClickArea.MouseEnter:Connect(function()
                Services.TS:Create(Frame, TweenFast, {BackgroundColor3 = Color3.fromRGB(32, 32, 32)}):Play()
            end)
            ClickArea.MouseLeave:Connect(function()
                Services.TS:Create(Frame, TweenFast, {BackgroundColor3 = Color3.fromRGB(28, 28, 28)}):Play()
            end)
        end

        table.insert(Window.Tabs, {Button = TabButton, Content = TabContent})
        return Tab
    end

    -- Insert Toggle
    Services.UIS.InputBegan:Connect(function(inp)
        if inp.KeyCode == Enum.KeyCode.Insert then
            Main.Visible = not Main.Visible
        end
    end)

    return Window
end

getgenv().Rayfield = Rayfield
print("[Rayfield] Loaded successfully! Press INSERT to toggle menu.")
